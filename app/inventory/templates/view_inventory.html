{% extends 'base.html' %}

{% block title %}Inventory List{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/inventory.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/forms.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/tables.css') }}">
{% endblock %}

{% block content %}
<div class="container">
    <h2>Inventory</h2>

    <!-- Collapsible Menu for Admin actions -->
    <button class="collapsible">Manage Inventory</button>
    <div class="content">
        <ul>
            <li><a href="{{ url_for('inventory.add_product') }}" class="btn">Add Product</a></li>
            <li><a href="{{ url_for('inventory.list_category') }}" class="btn">Manage Categories</a></li>
            <li><a href="{{ url_for('inventory.add_category') }}" class="btn">Add Category</a></li>
        </ul>
    </div>

    <table class="table">
        <thead>
            <tr>
                <th>Image</th>  <!-- New column for Image -->
                <th>Product Code</th>
                <th>Product Name</th>
                <th>Category</th>
                <th>Supplier</th>
                <th>Unit Price</th>
                <th>Stock Quantity</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>
                    {% if product.image %}
                        <img src="data:image/png;base64,{{ product.image|b64encode }}" alt="{{ product.product_name }}" style="width: 50px; height: 50px;"/>  <!-- Display image -->
                    {% else %}
                        <span>No Image</span>
                    {% endif %}
                </td>
                <td>{{ product.product_code if product.product_code else 'N/A' }}</td>
                <td>{{ product.product_name }}</td>
                <td>{{ product.category.category_name if product.category else 'N/A' }}</td>
                <td>{{ product.supplier.supplier_name if product.supplier else 'N/A' }}</td>
                <td>Ksh.{{ product.unit_price }}</td>
                <td>{{ product.stock_quantity }}</td>
                <td>
                    <a href="{{ url_for('inventory.add_inventory', product_id=product.product_id) }}" class="btn btn-primary btn-sm">Add Inventory</a>
                    <a href="{{ url_for('inventory.update_product', product_id=product.product_id) }}" class="btn btn-warning btn-sm">Edit</a><br><br>
                    <form method="POST" action="{{ url_for('inventory.delete_product', product_id=product.product_id) }}" onsubmit="return confirm('Are you sure you want to delete this product?');">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var coll = document.getElementsByClassName('collapsible');
        for (var i = 0; i < coll.length; i++) {
            coll[i].addEventListener('click', function() {
                this.classList.toggle('active');
                var content = this.nextElementSibling;
                if (content.style.display === 'block') {
                    content.style.display = 'none';
                } else {
                    content.style.display = 'block';
                }
            });
        }
    });
</script>
{% endblock %}
